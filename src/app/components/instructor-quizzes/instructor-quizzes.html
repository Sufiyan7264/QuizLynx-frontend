<div class="instructor-quizzes-page min-h-[calc(100vh-80px)] px-4 sm:px-6 lg:px-4 py-20 lg:py-20">
  <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between mb-8">
    <div>
      <!-- <p class="text-xs font-medium uppercase tracking-wide text-indigo-600 dark:text-indigo-300">Instructor Dashboard</p> -->
      <h1 class="text-2xl lg:text-2xl font-semibold text-slate-900 dark:text-slate-50">My Quizzes</h1>
      <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">Create and manage your quizzes</p>
    </div>
    <button 
      class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2 w-full sm:w-auto justify-center"
      (click)="openCreateDialog()">
      <i class="pi pi-plus"></i>
      <span>Create Quiz</span>
    </button>
  </div>

  <!-- Quizzes List -->
  <div class="quizzes-content">
    @if (quizzes.length === 0) {
      <div class="empty-state surface-card">
        <i class="pi pi-file-edit text-6xl text-slate-400 dark:text-slate-500 mb-4"></i>
        <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-50 mb-2">No quizzes yet</h3>
        <p class="text-slate-600 dark:text-slate-300 mb-4">Create your first quiz to get started</p>
        <button 
          class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2"
          (click)="openCreateDialog()">
          <i class="pi pi-plus"></i>
          <span>Create Quiz</span>
        </button>
      </div>
    } @else {
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 lg:grid-cols-3 gap-6">
        @for (quiz of quizzes; track quiz.id) {
          <div class="surface-card hoverable-card flex flex-col">
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-50 mb-1">{{ quiz.title }}</h3>
                @if (quiz.subject) {
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300">
                    {{ quiz.subject }}
                  </span>
                }
              </div>
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-semibold" 
                [ngClass]="getStatusClass(quiz.status)">
                {{ quiz.status || 'DRAFT' }}
              </span>
            </div>

            @if (quiz.description) {
              <p class="text-sm text-slate-600 dark:text-slate-300 mb-4 line-clamp-2">{{ quiz.description }}</p>
            }

            <div class="space-y-2 mb-4 flex-1">
              @if (quiz.timerInMin) {
                <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                  <i class="pi pi-clock text-indigo-500"></i>
                  <span>{{ quiz.timerInMin }} minutes</span>
                </div>
              }
              @if (quiz.totalMarks) {
                <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                  <i class="pi pi-star text-yellow-500"></i>
                  <span>{{ quiz.totalMarks }} marks</span>
                </div>
              }
              @if (quiz.passingMarks) {
                <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                  <i class="pi pi-check-circle text-green-500"></i>
                  <span>Pass: {{ quiz.passingMarks }} marks</span>
                </div>
              }
              @if (quiz.questionCount !== undefined) {
                <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                  <i class="pi pi-list text-purple-500"></i>
                  <span>{{ quiz.questionCount }} questions</span>
                </div>
              }
              @if (quiz.dueDate) {
                <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                  <i class="pi pi-calendar text-rose-500"></i>
                  <span>Due: {{ formatDisplayDate(quiz.dueDate) }}</span>
                </div>
              }
            </div>

            <div class="flex flex-col gap-2">
              <button
                class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center justify-center gap-2"
                (click)="addQuestions(quiz)">
                <i class="pi pi-plus"></i>
                <span>Add Questions</span>
              </button>
              <div class="flex gap-2">
                <button
                  class="flex-1 px-3 py-2 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-50 rounded-lg text-xs font-semibold transition-colors"
                  (click)="viewQuestions(quiz)"
                  title="View Questions">
                  <i class="pi pi-eye"></i>
                </button>
                <button
                  class="flex-1 px-3 py-2 bg-yellow-100 hover:bg-yellow-200 dark:bg-yellow-900/30 dark:hover:bg-yellow-900/50 text-yellow-700 dark:text-yellow-300 rounded-lg text-xs font-semibold transition-colors"
                  (click)="openEditDialog(quiz)"
                  title="Edit">
                  <i class="pi pi-pencil"></i>
                </button>
                <button
                  class="flex-1 px-3 py-2 bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg text-xs font-semibold transition-colors"
                  (click)="deleteQuiz(quiz)"
                  title="Delete">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Create/Edit Dialog -->
  <p-dialog
    [(visible)]="showCreateDialog"
    [header]="isEditMode ? 'Edit Quiz' : 'Create New Quiz'"
    [modal]="true"
    [style]="{ width: '600px' }"
    [closable]="true"
    (onHide)="closeDialog()"
  >
    <form [formGroup]="quizForm" (ngSubmit)="onSubmit()" class="quiz-form">
      <div class="form-group">
        <label for="title" class="form-label required">
          Quiz Title
        </label>
        <input
          id="title"
          type="text"
          pInputText
          formControlName="title"
          placeholder="e.g. Algebra Fundamentals Quiz"
          class="form-input ps-2"
          fluid
          [class.error]="quizForm.get('title')?.invalid && quizForm.get('title')?.touched"
        />
        @if (quizForm.get('title')?.invalid && quizForm.get('title')?.touched) {
          <span class="error-message">
            @if (quizForm.get('title')?.errors?.['required']) {
              Quiz title is required
            } @else if (quizForm.get('title')?.errors?.['minlength']) {
              Quiz title must be at least 3 characters
            }
          </span>
        }
      </div>

      <div class="form-group">
        <label for="description" class="form-label required">Description</label>
        <textarea
          id="description"
          pInputText
          fluid
          formControlName="description"
          placeholder="Enter quiz description (optional)"
          rows="3"
          class="form-textarea ps-2"
          [class.error]="quizForm.get('description')?.invalid && quizForm.get('description')?.touched"
        ></textarea>
        @if (quizForm.get('description')?.invalid && quizForm.get('description')?.touched) {
          <span class="error-message">
            @if (quizForm.get('description')?.errors?.['required']) {
              Description is required
            }
          </span>
        }
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="subject" class="form-label">Subject</label>
          <input
            id="subject"
            fluid
            type="text"
            pInputText
            formControlName="subject"
            placeholder="e.g. Mathematics"
            class="form-input ps-2"
            [class.error]="quizForm.get('subject')?.invalid && quizForm.get('subject')?.touched"
          />
          @if (quizForm.get('subject')?.invalid && quizForm.get('subject')?.touched) {
          <span class="error-message">
            @if (quizForm.get('subject')?.errors?.['required']) {
              Subject is required
            }
          </span>
          }
        </div>

        <div class="form-group">
          <label for="batchId" class="form-label required">Batch</label>
          <p-select
            id="batchId"
            formControlName="batchId"
            [options]="batches"
            optionLabel="batchName"
            optionValue="id"
            placeholder="Select batch"
            [invalid]="quizForm.get('batchId')?.invalid && quizForm.get('batchId')?.touched"
          ></p-select>
          @if (quizForm.get('batchId')?.invalid && quizForm.get('batchId')?.touched) {
            <span class="error-message">Batch is required</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="duration" class="form-label required">Duration (minutes)</label>
          <p-inputNumber
            id="duration"
            formControlName="timerInMin"
            [min]="1"
            [max]="300"
            placeholder="60"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-inputNumber>
          @if (quizForm.get('duration')?.invalid && quizForm.get('duration')?.touched) {
            <span class="error-message">Duration is required</span>
          }
        </div>

        <div class="form-group">
          <label for="status" class="form-label required">Status</label>
          <p-select
            id="status"
            formControlName="status"
            [options]="statusOptions"
            optionLabel="label"
            optionValue="value"
            styleClass="w-full"
            [invalid]="quizForm.get('status')?.invalid && quizForm.get('status')?.touched"
          ></p-select>
          @if (quizForm.get('status')?.invalid && quizForm.get('status')?.touched) {
            <span class="error-message">Status is required</span>
          }
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="totalMarks" class="form-label required">Total Marks</label>
          <p-inputNumber
            id="totalMarks"
            formControlName="totalMarks"
            [min]="1"
            placeholder="100"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-inputNumber>
        </div>

        <div class="form-group">
          <label for="passingMarks" class="form-label required">Passing Marks</label>
          <p-inputNumber
            id="passingMarks"
            formControlName="passingMarks"
            [min]="0"
            placeholder="50"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-inputNumber>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="startDate" class="form-label required">Start Date</label>
          <p-datepicker
            id="startDate"
            formControlName="startDate"
            dateFormat="yy-mm-dd"
            placeholder="Select start date"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-datepicker>
          @if (quizForm.get('startDate')?.invalid && quizForm.get('startDate')?.touched) {
            <span class="error-message">Start date is required</span>
          }
        </div>

        <div class="form-group">
          <label for="endDate" class="form-label required">End Date</label>
          <p-datepicker
            id="endDate"
            formControlName="endDate"
            dateFormat="yy-mm-dd"
            placeholder="Select end date"
            [minDate]="minEndDate"
            inputStyleClass="w-full"
          ></p-datepicker>
          @if (quizForm.get('endDate')?.invalid && quizForm.get('endDate')?.touched) {
            <span class="error-message">End date is required</span>
          }
        </div>
      </div>

      <div class="form-group">
        <label for="dueDate" class="form-label">Due Date</label>
        <p-datepicker
          id="dueDate"
          formControlName="dueDate"
          dateFormat="yy-mm-dd"
          placeholder="Select due date"
          [minDate]="minDueDate"
          styleClass="w-full"
          inputStyleClass="w-full"
        ></p-datepicker>
      </div>

      <div class="form-actions">
        <button type="button" pButton (click)="closeDialog()" class="cancel-btn">
          Cancel
        </button>
        <button type="submit" pButton [disabled]="quizForm.invalid" class="submit-btn">
          {{ isEditMode ? 'Update' : 'Create' }}
        </button>
      </div>
    </form>
  </p-dialog>
</div>

