<div class="instructor-dashboard !pt-24 px-2 sm:px-4 md:px-6">
  <!-- Statistics Cards Section -->
  <div class="stats-section grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 md:gap-4">
    @for (stat of stats; track $index) {
    <div class="stat-card">
      <div class="stat-header justify-between flex">
        <span class="stat-title text-sm font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wide">{{ stat.title
          }}</span>
        <span class="stat-period text-xs text-slate-400 dark:text-slate-500">{{ stat.period }}</span>
      </div>
      <div class="stat-content mt-2">
        <span class="stat-value text-3xl font-bold text-slate-900 dark:text-slate-50">{{ stat.value }}</span>
        <span
          class="stat-change ml-2 text-sm font-semibold px-2 py-0.5 rounded-full"
          [class.increase]="stat.changeType === 'increase'"
          [class.decrease]="stat.changeType === 'decrease'"
        >
          <i [class]="stat.changeType === 'increase' ? 'pi pi-arrow-up text-xs' : 'pi pi-arrow-down text-xs'"></i>
          {{ stat.change }}%
        </span>
      </div>
    </div>

    }
  </div>

  <!-- Main Content Section -->
  <div class="main-content grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-2 md:gap-4">
    <!-- Left Section -->
    <div class="left-section flex flex-col gap-2 md:gap-4">
      <!-- Charts Grid -->
      <div class="charts-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-2 md:gap-4">
        <!-- Line Chart - Student Engagement -->
        <div class="chart-card">
          <app-chart-configuration
            [chartType]="'line'"
            [data]="studentEngagementData"
            [width]="'100%'"
            [height]="'300px'"
            [options]="studentEngagementOptions"
          >
          </app-chart-configuration>
        </div>

        <!-- Bar Chart - Student Performance by Quiz -->
        <div class="chart-card">
          <app-chart-configuration
            [chartType]="'bar'"
            [data]="studentPerformanceData"
            [width]="'100%'"
            [height]="'300px'"
            [options]="studentPerformanceOptions"
          >
          </app-chart-configuration>
        </div>

        <!-- Pie Chart - Quiz Completion Status -->
        <div class="chart-card">
          <app-chart-configuration
            [chartType]="'pie'"
            [data]="quizCompletionData"
            [width]="'100%'"
            [height]="'300px'"
            [options]="quizCompletionOptions"
          >
          </app-chart-configuration>
        </div>
        <!-- Quick Stats Card -->
        <div class="chart-card quick-stats-card md:col-span-2 lg:col-span-1">
          <div class="card-header mb-4 border-b border-slate-100 dark:border-slate-700/50 pb-3">
            <h3 class="card-title text-lg font-bold text-slate-900 dark:text-slate-50">Quick Statistics</h3>
          </div>
          <div class="quick-stats-grid grid grid-cols-1 sm:grid-cols-2 gap-2 md:gap-4">
            <div class="quick-stat-item">
              <div class="quick-stat-icon">
                <i class="pi pi-users"></i>
              </div>
              <div class="quick-stat-content">
                <div class="quick-stat-value">{{ quickStats.totalStudents }}</div>
                <div class="quick-stat-label">Total Students</div>
              </div>
            </div>
            <div class="quick-stat-item">
              <div class="quick-stat-icon">
                <i class="pi pi-check-circle"></i>
              </div>
              <div class="quick-stat-content">
                <div class="quick-stat-value">{{ quickStats.topPerformers }}</div>
                <div class="quick-stat-label">Top Performers (90%+)</div>
              </div>
            </div>
            <div class="quick-stat-item">
              <div class="quick-stat-icon">
                <i class="pi pi-clock"></i>
              </div>
              <div class="quick-stat-content">
                <div class="quick-stat-value">{{ quickStats.averageCompletionTime }}</div>
                <div class="quick-stat-label">Avg. Completion Time</div>
              </div>
            </div>
            <div class="quick-stat-item">
              <div class="quick-stat-icon">
                <i class="pi pi-star"></i>
              </div>
              <div class="quick-stat-content">
                <div class="quick-stat-value">{{ quickStats.averageScore }}%</div>
                <div class="quick-stat-label">Overall Average Score</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Section -->
    <div class="right-section flex flex-col gap-2 md:gap-4">
      <!-- Performance Summary Chart -->
      <div class="performance-summary-card">
        <app-chart-configuration
          [chartType]="'pie'"
          [data]="performanceSummaryData"
          [width]="'100%'"
          [height]="'280px'"
          [options]="performanceSummaryOptions"
        >
        </app-chart-configuration>
      </div>

      <!-- Students Needing Attention -->
      <div class="attention-card">
        <div class="card-header mb-4 border-b border-slate-100 dark:border-slate-700/50 pb-3">
          <h3 class="card-title text-lg font-bold text-slate-900 dark:text-slate-50">Students Needing Attention</h3>
        </div>
        <div class="attention-list flex flex-col gap-2 md:gap-3">
          @for (student of studentsNeedingAttention; track $index) {
            <div class="attention-item flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2">
              <div class="student-info flex-1">
                <div class="student-name text-sm md:text-base font-semibold mb-1">{{ student.name }}</div>
                <div class="student-details flex flex-col sm:flex-row gap-2 text-xs md:text-sm">
                  <span class="detail-item">Score: {{ student.score ?? student.averageScore }}%</span>
                  <span class="detail-item">Quizzes: {{ student.quizzesCompleted }}</span>
                </div>
              </div>
              <div class="attention-badge text-lg md:text-xl flex-shrink-0">
                <i class="pi pi-exclamation-triangle"></i>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
  <!-- Top Students Card -->
  <div class="chart-card top-students-card mt-4">
    <div
      class="card-header flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-4 border-slate-100 dark:border-slate-700/50 pb-3">
      <h3 class="card-title text-lg font-bold text-slate-900 dark:text-slate-50">Top Performing Students</h3>
      <a href="/instructor/students"
        class="view-all-link text-sm font-medium text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300 transition-colors">View
        all</a>
    </div>
    <div class="overflow-x-auto">
      <table class="students-table w-full min-w-[600px]">
        <thead>
          <tr>
            <th class="text-xs md:text-sm">Rank</th>
            <th class="text-xs md:text-sm">Student Name</th>
            <th class="text-xs md:text-sm">Average Score</th>
            <th class="text-xs md:text-sm">Quizzes Completed</th>
            <th class="text-xs md:text-sm">Status</th>
          </tr>
        </thead>
        <tbody>
          @for (student of topStudents; track $index) {
          <tr>
            <td class="rank-cell text-center">
              <span
                class="rank-badge inline-flex items-center justify-center w-6 h-6 md:w-8 md:h-8 text-xs md:text-sm"
                [class.top-1]="$index === 0"
                [class.top-2]="$index === 1"
                [class.top-3]="$index === 2"
              >
                {{ $index + 1 }}
              </span>
            </td>
            <td class="text-xs md:text-sm">{{ student.name }}</td>
            <td class="text-xs md:text-sm">
              <span class="score-value font-semibold">{{ student.averageScore }}%</span>
            </td>
            <td class="text-xs md:text-sm">{{ student.quizzesCompleted }}</td>
            <td>
              <span
                class="status-badge text-xs inline-block px-2 md:px-3 py-1"
                [class.excellent]="student.averageScore >= 90"
                [class.good]="student.averageScore >= 75 && student.averageScore < 90"
                [class.average]="student.averageScore < 75"
              >
                {{ student.status }}
              </span>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>

<p-dialog
  header="Update Profile"
  styleClass="p-4 bg-bg border text-text border-border"
  [(visible)]="visible"
  [style]="{ width: '90vw', maxWidth: '50rem' }"
  [modal]="true"
  [closable]="false"
>
  <form [formGroup]="updateForm" (ngSubmit)="onSubmit()">
    <span class="p-text-secondary block mb-4 md:mb-8 text-text text-sm md:text-base">Update your information.</span>
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 mb-4 md:mb-8">
      <label for="username" class="font-semibold w-full sm:w-24 text-sm md:text-base required">Full Name</label>
      <input
        pInputText
        formControlName="displayName"
        id="username"
        class="flex-auto border-border border h-9 md:h-[36px] px-2 text-sm md:text-base"
        placeholder="Enter the full name"
        autocomplete="off"
      />
    </div>
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 mb-4 md:mb-8">
      <label for="email" class="font-semibold w-full sm:w-24 text-sm md:text-base">Bio</label>
      <textarea
        pInputText
        formControlName="bio"
        id="email"
        placeholder="Enter the bio (max 1000 characters)"
        class="flex-auto border border-border px-2 py-2 text-sm md:text-base min-h-[80px]"
        autocomplete="off"
      ></textarea>
    </div>
    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-4 mb-4 md:mb-8">
      <label for="subjects" class="font-semibold w-full sm:w-28 text-sm md:text-base required">Subjects</label>
      <p-multiselect
        formControlName="subjects"
        [options]="subjectOptions"
        appendTo="body"
        [filter]="true"
        optionLabel="label"
        optionValue="value"
        placeholder="Select Subjects"
        [maxSelectedLabels]="3"
        class="w-full h-9 md:h-[36px] border border-border px-2"
        fluid
      />
    </div>
    <div class="flex flex-col sm:flex-row justify-end gap-2">
      <p-button
        type="submit"
        class="bg-primary p-2 rounded-md text-white hover:bg-blue-500 hover:shadow-lg text-sm md:text-base w-full sm:w-auto"
        label="Save"
      />
    </div>
  </form>
</p-dialog>
