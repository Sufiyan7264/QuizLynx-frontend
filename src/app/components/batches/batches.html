<div class="batches-page min-h-[calc(100vh-80px)] px-4 sm:px-6 lg:px-4 py-6 lg:py-20 pt-24">
  <div class="flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between mb-8">
    <div>
      <!-- <p class="text-xs font-medium uppercase tracking-wide text-indigo-600 dark:text-indigo-300">Instructor Dashboard</p> -->
      <h1 class="text-2xl lg:text-2xl font-semibold text-slate-900 dark:text-slate-50">My Classes</h1>
      <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">Manage your student batches</p>
    </div>
    <button 
      class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2 w-full sm:w-auto justify-center"
      (click)="openCreateDialog()">
      <i class="pi pi-plus"></i>
      <span>Create Batch</span>
    </button>
  </div>

  <!-- Search Section -->
  @if (batches.length > 0) {
    <section class="surface-card mb-6">
      <div class="flex flex-col sm:flex-row gap-4 items-end">
        <div class="flex-1">
          <label for="searchBatches" class="block text-sm font-semibold text-slate-900 dark:text-slate-50 mb-2">
            <i class="pi pi-search mr-2"></i>
            Search Batches
          </label>
          <input
            id="searchBatches"
            type="text"
            pInputText
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearchChange()"
            placeholder="Search by name, description, or batch code..."
            class="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-50 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400"
          />
        </div>
        @if (searchTerm) {
          <button
            class="px-4 py-2 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-lg hover:bg-slate-800 dark:hover:bg-slate-200 transition-colors text-sm font-semibold"
            (click)="clearSearch()">
            <i class="pi pi-times mr-2"></i>
            Clear Search
          </button>
        }
      </div>
    </section>
  }

  <!-- Batches List -->
  <div class="batches-content">
    @if (batches.length === 0) {
      <div class="empty-state surface-card">
        <i class="pi pi-book text-6xl text-slate-400 dark:text-slate-500 mb-4"></i>
        <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-50 mb-2">No batches yet</h3>
        <p class="text-slate-600 dark:text-slate-300 mb-4">Create your first batch to organize your students</p>
        <button 
          class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors flex items-center gap-2"
          (click)="openCreateDialog()">
          <i class="pi pi-plus"></i>
          <span>Create Batch</span>
        </button>
      </div>
    } @else if (filteredBatches.length === 0 && searchTerm) {
      <div class="empty-state surface-card">
        <i class="pi pi-search text-6xl text-slate-400 dark:text-slate-500 mb-4"></i>
        <h3 class="text-xl font-semibold text-slate-900 dark:text-slate-50 mb-2">No batches found</h3>
        <p class="text-slate-600 dark:text-slate-300 mb-4">Try adjusting your search criteria</p>
        <button
          class="px-4 py-2 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-lg hover:bg-slate-800 dark:hover:bg-slate-200 transition-colors text-sm font-semibold"
          (click)="clearSearch()">
          <i class="pi pi-times mr-2"></i>
          Clear Search
        </button>
      </div>
    } @else {
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 lg:grid-cols-3 gap-6">
        @for (batch of filteredBatches; track batch.id) {
          <div class="surface-card hoverable-card flex flex-col cursor-pointer" (click)="viewBatchDetail(batch)">
            <div class="flex items-start justify-between mb-4">
              <div class="flex-1">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-50 mb-1">{{ batch.batchName }}</h3>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300">
                  {{ batch.batchCode }}
                </span>
              </div>
              <div class="flex gap-1" (click)="$event.stopPropagation()">
                <button
                  class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"
                  (click)="viewBatchDetail(batch)"
                  title="View Details">
                  <i class="pi pi-eye text-slate-600 dark:text-slate-300"></i>
                </button>
                <button
                  class="p-2 rounded-lg hover:bg-yellow-100 dark:hover:bg-yellow-900/30 transition-colors"
                  (click)="openEditDialog(batch)"
                  title="Edit">
                  <i class="pi pi-pencil text-yellow-600 dark:text-yellow-400"></i>
                </button>
                <button
                  class="p-2 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors"
                  (click)="deleteBatch(batch)"
                  title="Delete">
                  <i class="pi pi-trash text-red-600 dark:text-red-400"></i>
                </button>
              </div>
            </div>

            @if (batch.description) {
              <p class="text-sm text-slate-600 dark:text-slate-300 mb-4 line-clamp-2">{{ batch.description }}</p>
            }

            <div class="space-y-2 mb-4 flex-1">
              <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                <i class="pi pi-users text-indigo-500"></i>
                <span>{{ batch.studentCount || 0 }} Students</span>
              </div>
              <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                <i class="pi pi-book text-purple-500"></i>
                <span>{{ batch.quizCount || 0 }} Quizzes</span>
              </div>
              @if (batch.startDate || batch.endDate) {
                <div class="flex items-center gap-2 text-sm text-slate-600 dark:text-slate-300">
                  <i class="pi pi-calendar text-rose-500"></i>
                  <span>
                    @if (batch.startDate && batch.endDate) {
                      {{ formatDisplayDate(batch.startDate) }} - {{ formatDisplayDate(batch.endDate) }}
                    } @else if (batch.startDate) {
                      Starts: {{ formatDisplayDate(batch.startDate) }}
                    } @else if (batch.endDate) {
                      Ends: {{ formatDisplayDate(batch.endDate) }}
                    }
                  </span>
                </div>
              }
            </div>

            <button
              class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors"
              (click)="viewBatchDetail(batch)">
              View Details
            </button>
          </div>
        }
      </div>
    }
  </div>

  <!-- Create/Edit Dialog -->
  <p-dialog
    [(visible)]="showCreateDialog"
    [header]="isEditMode ? 'Edit Batch' : 'Create New Batch'"
    [modal]="true"
    [style]="{ width: '90vw', maxWidth: '500px' }"
    [closable]="true"
    (onHide)="closeDialog()"
    styleClass="bg-bg text-text border border-border"
  >
    <form [formGroup]="batchForm" (ngSubmit)="onSubmit()" class="batch-form">
      <div class="form-group">
        <label for="batchName" class="form-label required">
          Batch Name
        </label>
        <input
          id="batchName"
          type="text"
          pInputText
          formControlName="batchName"
          placeholder="e.g. Class 10 Physics"
          class="form-input"
          [class.error]="batchForm.get('batchName')?.invalid && batchForm.get('batchName')?.touched"
        />
        @if (batchForm.get('batchName')?.invalid && batchForm.get('batchName')?.touched) {
          <span class="error-message">
            @if (batchForm.get('batchName')?.errors?.['required']) {
              Batch name is required
            } @else if (batchForm.get('batchName')?.errors?.['minlength']) {
              Batch name must be at least 3 characters
            }
          </span>
        }
      </div>

      <div class="form-group">
        <label for="description" class="form-label">Description</label>
        <textarea
          id="description"
          pInputText
          formControlName="description"
          placeholder="Enter batch description (optional)"
          rows="4"
          class="form-textarea"
        ></textarea>
      </div>

      <!-- <div class="form-row">
        <div class="form-group">
          <label for="startDate" class="form-label">Start Date</label>
          <p-datepicker
            id="startDate"
            formControlName="startDate"
            dateFormat="yy-mm-dd"
            placeholder="Select start date"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-datepicker>
        </div>

        <div class="form-group">
          <label for="endDate" class="form-label">End Date</label>
          <p-datepicker
            id="endDate"
            formControlName="endDate"
            dateFormat="yy-mm-dd"
            placeholder="Select end date"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-datepicker>
        </div>
      </div> -->

      <div class="form-actions">
        <button type="button" pButton (click)="closeDialog()" class="cancel-btn">
          Cancel
        </button>
        <button type="submit" pButton [disabled]="batchForm.invalid" class="submit-btn">
          {{ isEditMode ? 'Update' : 'Create' }}
        </button>
      </div>
    </form>
  </p-dialog>
</div>

