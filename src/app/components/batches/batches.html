<div class="batches-container !pt-24">
  <p-toast></p-toast>
  
  <!-- Header Section -->
  <div class="batches-header">
    <div class="header-content">
      <h1 class="page-title">Batches</h1>
      <p class="page-subtitle">Manage your student batches</p>
    </div>
    <button class="create-btn" (click)="openCreateDialog()">
      <i class="pi pi-plus"></i>
      <span>Create Batch</span>
    </button>
  </div>

  <!-- Batches List -->
  <div class="batches-list">
    @if (batches.length === 0) {
      <div class="empty-state">
        <i class="pi pi-users empty-icon"></i>
        <h3>No batches yet</h3>
        <p>Create your first batch to organize your students</p>
        <button class="create-btn" (click)="openCreateDialog()">
          <i class="pi pi-plus"></i>
          <span>Create Batch</span>
        </button>
      </div>
    } @else {
      <div class="batches-grid">
        @for (batch of batches; track batch.id) {
          <div class="batch-card">
            <div class="batch-header">
              <div class="batch-icon">
                <i class="pi pi-users"></i>
              </div>
              <div class="batch-actions">
                <button class="action-btn edit-btn" (click)="openEditDialog(batch)" title="Edit">
                  <i class="pi pi-pencil"></i>
                </button>
                <button class="action-btn delete-btn" (click)="deleteBatch(batch)" title="Delete">
                  <i class="pi pi-trash"></i>
                </button>
              </div>
            </div>
            
            <div class="batch-content">
              <h3 class="batch-name">{{ batch.name }}</h3>
              @if (batch.description) {
                <p class="batch-description">{{ batch.description }}</p>
              }
              
              <div class="batch-info">
                <div class="info-item">
                  <i class="pi pi-users"></i>
                  <span>{{ batch.studentCount || 0 }} Students</span>
                </div>
                @if (batch.startDate || batch.endDate) {
                  <div class="info-item">
                    <i class="pi pi-calendar"></i>
                    <span>
                      @if (batch.startDate && batch.endDate) {
                        {{ formatDisplayDate(batch.startDate) }} - {{ formatDisplayDate(batch.endDate) }}
                      } @else if (batch.startDate) {
                        Starts: {{ formatDisplayDate(batch.startDate) }}
                      } @else if (batch.endDate) {
                        Ends: {{ formatDisplayDate(batch.endDate) }}
                      }
                    </span>
                  </div>
                }
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Create/Edit Dialog -->
  <p-dialog
    [(visible)]="showCreateDialog"
    [header]="isEditMode ? 'Edit Batch' : 'Create New Batch'"
    [modal]="true"
    [style]="{ width: '500px' }"
    [closable]="true"
    (onHide)="closeDialog()"
  >
    <form [formGroup]="batchForm" (ngSubmit)="onSubmit()" class="batch-form">
      <div class="form-group">
        <label for="name" class="form-label required">
          Batch Name
        </label>
        <input
          id="name"
          type="text"
          pInputText
          formControlName="name"
          placeholder="e.g. Class 10 Physics"
          class="form-input"
          [class.error]="batchForm.get('name')?.invalid && batchForm.get('name')?.touched"
        />
        @if (batchForm.get('name')?.invalid && batchForm.get('name')?.touched) {
          <span class="error-message">
            @if (batchForm.get('name')?.errors?.['required']) {
              Batch name is required
            } @else if (batchForm.get('name')?.errors?.['minlength']) {
              Batch name must be at least 3 characters
            }
          </span>
        }
      </div>

      <div class="form-group">
        <label for="description" class="form-label">Description</label>
        <textarea
          id="description"
          pInputText
          formControlName="description"
          placeholder="Enter batch description (optional)"
          rows="4"
          class="form-textarea"
        ></textarea>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="startDate" class="form-label">Start Date</label>
          <p-datepicker
            id="startDate"
            formControlName="startDate"
            dateFormat="yy-mm-dd"
            placeholder="Select start date"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-datepicker>
        </div>

        <div class="form-group">
          <label for="endDate" class="form-label">End Date</label>
          <p-datepicker
            id="endDate"
            formControlName="endDate"
            dateFormat="yy-mm-dd"
            placeholder="Select end date"
            styleClass="w-full"
            inputStyleClass="w-full"
          ></p-datepicker>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" pButton (click)="closeDialog()" class="cancel-btn">
          Cancel
        </button>
        <button type="submit" pButton [disabled]="batchForm.invalid" class="submit-btn">
          {{ isEditMode ? 'Update' : 'Create' }}
        </button>
      </div>
    </form>
  </p-dialog>
</div>

